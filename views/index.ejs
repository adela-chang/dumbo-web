<%- include partials/top %>
        <!-- Top content -->
        <div class="top-content">
            <div class="container">
                <div class="row">
                    <div class="col-sm-12 text">
                		<h1>Addressing the elephant in the room</h1>
                        <h2>Make your recording here</h2>
                        <button class="btn btn-lg btn-success" onclick="startRecording(this);">Record</button>
                        <button class="btn btn-lg btn-danger" onclick="stopRecording(this);" disabled>Stop</button>
						
						<h2>Recordings</h2>
						<ul id="recordingslist"></ul>

						<h3>Current Log Screen</h3>
						<pre id="log" class="well"></pre>

						<!-- Recording script -->
						<script type="text/javascript">
						    function __log(e, data) {
						        log.innerHTML += "\n" + e + " " + (data || '');
						    }
						    
						    var audio_context;
						    var recorder;

						    function startUserMedia(stream) {
						        var input = audio_context.createMediaStreamSource(stream);
						        __log('Media stream created.');
						        // Uncomment if you want the audio to feedback directly
						        //input.connect(audio_context.destination);
						        //__log('Input connected to audio context destination.');

						        recorder = new Recorder(input);
						        __log('Recorder initialised.');
						    }

						    function startRecording(button) {
						        recorder && recorder.record();
						        button.disabled = true;
						        button.nextElementSibling.disabled = false;
						        __log('Recording...');
						    }

						    function stopRecording(button) {
						        recorder && recorder.stop();
						        button.disabled = true;
						        button.previousElementSibling.disabled = false;
						        __log('Stopped recording.');

						        // create WAV download link using audio data blob
						        createDownloadLink();

						        recorder.clear();
						    }

						    function createDownloadLink() {
						        recorder && recorder.exportWAV(function(blob) {

						            console.log(blob)

									// var fd = new FormData();
									// fd.append('fname', 'test.wav');
									// fd.append('data', blob);
									// console.log(fd);

									$.ajax({
									    type: 'POST',
									    url: 'http://52.90.98.146:9000/send',
									    data: blob,
									    processData: false,
									    contentType: false
									}).done(function(data) {
									       console.log(data);
									});

						        });
						    }

						    //Setup for Web Audio Recordings
						    window.onload = function init() {
						        try {
						            // webkit shim
						            window.AudioContext = window.AudioContext || window.webkitAudioContext;
						            navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;
						            window.URL = window.URL || window.webkitURL;

						            audio_context = new AudioContext;
						            __log('Audio context set up.');
						            __log('navigator.getUserMedia ' + (navigator.getUserMedia ? 'available.' : 'not present!'));
						        } catch (e) {
						            alert('No web audio support in this browser!');
						        }

						        navigator.getUserMedia({
						            audio: true
						        }, startUserMedia, function(e) {
						            __log('No live audio input: ' + e);
						        });
						    };
						</script>

                        <div class="container">
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3">
                                    <form action="/viewdetail" method="GET">
                                        <div id="searchbar" class="input-group input-group-lg">
                                            <input type="file" accept="image/*;capture=camera"class="form-control" name="lemonId" placeholder="Go ahead, say something. " required= "true">
                                            <span class="input-group-btn">
                                                <input class="btn btn-success btn-default" type="submit" value="Record!">
                                            </span>
                                        </div>                   
                                    </form>
                                </div>
                            </div>
                        </div>                     
                        <div class="description">
                        	<p class="medium-paragraph">
                         	Some type of descriptive text will go here
                        	</p>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
        <script src="/js/recorder.js"></script>
<%- include partials/bottom %>
